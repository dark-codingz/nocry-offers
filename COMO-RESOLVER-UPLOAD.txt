â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
  ğŸ¯ SOLUÃ‡ÃƒO: Erro RLS no Upload de Arquivos
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ERRO:
  "Erro ao enviar arquivo: new row violates row-level security policy"

CAUSA:
  PolÃ­ticas RLS do Supabase Storage nÃ£o configuradas.

SOLUÃ‡ÃƒO (2 minutos):
  
  1ï¸âƒ£ CRIAR BUCKET
     â€¢ Ir: Supabase Dashboard â†’ Storage â†’ Buckets
     â€¢ Criar: "offers-files" (PRIVADO)
  
  2ï¸âƒ£ CONFIGURAR RLS
     â€¢ Ir: Storage â†’ offers-files â†’ Policies
     â€¢ Adicionar 4 polÃ­ticas SQL (copiar de SOLUCAO-RAPIDA-UPLOAD.md)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“‹ POLÃTICAS SQL (Copiar e Colar):

-- PolÃ­tica 1: INSERT (Upload)
CREATE POLICY "UsuÃ¡rios autenticados podem fazer upload"
ON storage.objects FOR INSERT
TO authenticated
WITH CHECK (bucket_id = 'offers-files');

-- PolÃ­tica 2: SELECT (Download)
CREATE POLICY "UsuÃ¡rios autenticados podem baixar"
ON storage.objects FOR SELECT
TO authenticated
USING (bucket_id = 'offers-files');

-- PolÃ­tica 3: UPDATE
CREATE POLICY "UsuÃ¡rios autenticados podem atualizar"
ON storage.objects FOR UPDATE
TO authenticated
USING (bucket_id = 'offers-files')
WITH CHECK (bucket_id = 'offers-files');

-- PolÃ­tica 4: DELETE
CREATE POLICY "UsuÃ¡rios autenticados podem deletar"
ON storage.objects FOR DELETE
TO authenticated
USING (bucket_id = 'offers-files');

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ§ª TESTAR:

  1. Acessar: http://localhost:3000/diagnostics/upload
     âœ… Deve mostrar: "PolÃ­ticas RLS configuradas corretamente"
  
  2. Ir para uma oferta â†’ Tab "Anexos"
     âœ… Upload deve funcionar sem erro

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ“š DOCUMENTAÃ‡ÃƒO COMPLETA:

  â€¢ SOLUCAO-RAPIDA-UPLOAD.md      â†’ SoluÃ§Ã£o rÃ¡pida
  â€¢ GUIA-VISUAL-STORAGE-RLS.md    â†’ Guia visual
  â€¢ DIAGNOSTICO-UPLOAD-RLS.md     â†’ TÃ©cnico detalhado
  â€¢ RESUMO-DIAGNOSTICO-UPLOAD.md  â†’ Resumo executivo

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

âœ… IMPLEMENTADO NO CÃ“DIGO:

  âœ… Logs detalhados de upload
  âœ… Mensagens de erro especÃ­ficas
  âœ… PÃ¡gina de diagnÃ³stico automÃ¡tico (/diagnostics/upload)
  âœ… DocumentaÃ§Ã£o completa
  âœ… DetecÃ§Ã£o de erro RLS

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ğŸ‰ PRONTO!
   ApÃ³s configurar as 4 polÃ­ticas, o upload funcionarÃ¡!




